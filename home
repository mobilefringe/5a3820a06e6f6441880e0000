<div class="popup_home hidden_now">
    <a href="#">
        <img src="#" alt="pop up" />
    </a>
    <i class="fa fa-remove close_popup"></i>
</div>
<div class="home_banner">   
    <div class="flexslider">
        <ul class="slides" id="home_banner">
            <script id="banner_template" type="x-tmpl-mustache/text">
                <li>
                    <a href="{{url}}" {{css}} onclick="{{noLink}}">
                        <div class="banner_img" style="background-image: url({{image_url}});"
                    </a>
                </li>
            </script>
        </ul>
    </div>
</div>

<div class="feature_container">
    <div class="content_container">
        <div class="flex_container">
            <div id="feature_container">
                <script id="feature_template" type="x-tmpl-mustache/text">
                    <div class="width_30">
                        <a href="{{url}}">
                            <img src="{{image_url}}" alt="{{name}}"/>
                        </a>
                    </div>
                </script>
            </div>
        </div>
    </div>
</div>
<div class="content_container">
    <div class="promo_blog_container">
        <div id="giftcard_feature_container" class="col-sm-6 text-center">
            <script id="giftcard_feature_template" type="x-tmpl-mustache/text">
                <a href="{{url}}" class="">
                    <img src="{{image_url}}" alt="Promotional Image">
                </a>
            </script>
        </div>
        <div class="col-sm-6">
            <div class="home_promos">
                <h2 class="details_title caps">Promos</h2>
                <div id="home_promo_container" class="dine_container margin_20">
                    <script id="home_promo_template" type="x-tmpl-mustache/text">
                        <div class="margin_30">
                            <div class="" style="position:relative;display: inline-block;">
                                <h3 class="home_store_name"> {{store_name}} </h3>
                            </div>
                            
                            <h2 class="home_promo_name"> {{name}} </h2>
                            <p class="home_promo_dates"> {{dates }} <span style="color:#ff5455;"> {{days_left}}</span></p>
                            <p class="home_promo_desc">{{description_short}}</p>
                            <a class="home_read_more caps" href="/promotions/{{slug}}"><p>Read More</p></a>
                        </div>
                    </script>
                </div>
                <p class="home_see_all"><a href="/promotions">See all sales & promotions </a> <i class="fa fa-angle-right" aria-hidden="true"></i></p>
            </div>
        </div>
    </div>
    <div class="promo_blog_container">
        <div class="col-sm-6 hidden_phone">
            <div class="home_promos">
                <h2 class="details_title caps"><img src="//codecloud.cdn.speedyrails.net/sites/5aa1884a6e6f64062b310000/image/png/1517342534000/crowniconbrown-01.png" class="" alt="" style="height: 20px;margin-bottom: 7px;">&nbsp;&nbsp;&nbsp;Blog</h2>
                <div id="home_blog_container" class="dine_container margin_20">
                    <script id="home_blog_template" type="x-tmpl-mustache/text">
                        <div class="margin_30">
                            <h2 class="home_promo_name"> {{title}} </h2>
                            <p class="home_promo_dates"> {{publish_date}} <span style="color:#ff5455;"> {{latest_post}}</span></p>
                            <a class="home_read_more caps" href="/posts/{{slug}}"><p>Read More</p></a>
                        </div>
                    </script>
                </div>
                <!--<p class="home_see_all"><a href="/blog">See all news articles </a> <i class="fa fa-angle-right" aria-hidden="true"></i></p>-->
            </div>
        </div>
        <div id="blog_feature_container" class="col-sm-6 text-center">
            <script id="blog_feature_template" type="x-tmpl-mustache/text">
                <a href="{{url}}" class="">
                    <img src="{{image_url}}" alt="Promotional Image">
                </a>
            </script>
        </div>
        <div class="col-sm-6 show_phone">
            <div class="home_promos">
                <h2 class="details_title caps"><img src="//codecloud.cdn.speedyrails.net/sites/5aa1884a6e6f64062b310000/image/png/1517342534000/crowniconbrown-01.png" class="" alt="" style="height: 30px;margin-bottom: 10px;">&nbsp;&nbsp;Blog</h2>
                <div id="home_mblog_container" class="dine_container margin_20">
                    <script id="home_mblog_template" type="x-tmpl-mustache/text">
                        <div class="margin_30">
                            <h2 class="home_promo_name"> {{title}} </h2>
                            <p class="home_promo_dates"> {{publish_date}} <span style="color:#ff5455;"> {{latest_post}}</span></p>
                            <a class="home_read_more caps" href="/posts/{{slug}}"><p>Read More</p></a>
                        </div>
                    </script>
                </div>
                <!--<p class="home_see_all"><a href="/blog">See all news articles </a> <i class="fa fa-angle-right" aria-hidden="true"></i></p>-->
            </div>
        </div>
    </div>
</div>
<div class="feature_container feature_container_logo">
    <div class="logo_scroll">
        <div id="slider_container">
            <!-- Slides Container -->
            <div id="logo_container" class="logo_slides" u="slides">
                <script id="logo_template" type="x-tmpl-mustache/text">
                    <div><img u="image" alt="amazon" src="{{store_logo}}" /></div>
                </script>
            </div>
        </div>
    </div> 
</div>
<div class="home_subscription">
    <div class="subscribeBlog content_container">
         <h1>Sign up for our e-newsletter</h1> 
        <form id="newsletterBlogForm">
            <label for="fieldEmail" style="display:none"></label>
            <div>
                <input id="fieldEmail" name="cm-ykouu-ykouu" class="form-control" type="email" value="" placeholder="Email address" required/> 
                <button class="contact_btn" data-i18n="general.submit" id="newsletterSignupBtn">Sign Up</button>
            </div>
            <!--<span id="success_subscribe" class="hidden_now">Thank you for subscribing to our newsletter.</span>-->
        </form>
    </div>
</div>
<script>
    $(document).ready(function(e) {
        init(e);
        function renderAll (){
            //render Popup
            if($.cookie("popup_viewed") != "true"){
                $.cookie("popup_viewed", "true", { expires: 1 });
                var popup = getPopups()[0];
                if (popup != undefined){
                    $('.popup_home a').attr('href', popup.photo_link)
                    $('.popup_home img').attr('src', '//mallmaverick.cdn.speedyrails.net' + popup.photo_url)
                    $('<div class="modal-backdrop custom_backdrop"></div>').appendTo(document.body);
                    $('.popup_home').show()
                    $("body").addClass('no_scroll');
                }
            }
            $('.close_popup, .custom_backdrop').click(function(){
                $(".modal-backdrop").remove();
		        $(".popup_home").remove();
		        $("body").removeClass('no_scroll');
            })
            
            var banners = getBanners();
            renderBanner('#banner_template','#home_banner', banners);
            
            var all_feature_items = getFeatureList();
            var three_items = all_feature_items.slice(0, 3);
            renderGeneral('#feature_container','#feature_template', three_items);
            
            var giftcard_image = all_feature_items[3];
            renderSingleItem('#giftcard_feature_container','#giftcard_feature_template', giftcard_image);
            
            var blog_image = all_feature_items[4];
            renderSingleItem('#blog_feature_container','#blog_feature_template', blog_image);
            
            // PROMOTIONS
            var promotions = getPromotionsList().sortBy(function(o){ return o.end_date });
            var published_promos = [];
            $.each(promotions, function(key, val){
                today = moment();
                webDate = moment(val.show_on_web_date)
                if (today.tz(getPropertyTimeZone()) >= webDate.tz(getPropertyTimeZone())) {
                    published_promos.push(val);
                }
            });
            renderPromotions('#home_promo_container','#home_promo_template', published_promos);
            
            // BLOGS
            var blog_posts = getBlogDataBySlug('cornwall-queen-city').posts.sortBy(function(o){return o.publish_date;}).reverse().slice(0, 4);
            blog_posts[0].latest_post = "/ NEW POST!";
            renderPosts('#home_blog_container','#home_blog_template', blog_posts);
            renderPosts('#home_mblog_container','#home_mblog_template', blog_posts);
            
            // LOGO SCROLL
            var stores = getStoresList();
            stores = stores.filter(function( val, index ) {
                if (val.tags != null && _.includes(val.tags, 'featured')) {
                    return (!$.isNumeric(val.name[0])) && !(val.store_front_url_abs.indexOf('missing') > -1);
                }
            });
            renderLogoScroll('#logo_container','#logo_template', stores);

            show_content();
            
            $('.flexslider').flexslider({
                animation: "slide",
            });
            
            var logo_options = {
                $AutoPlay: true,
                $AutoPlaySteps: 1,                                 
                $AutoPlayInterval: 0,                            
                $PauseOnHover: 4,                               
                $ArrowKeyNavigation: true,   			            
                $SlideEasing: $JssorEasing$.$EaseLinear,          
                $SlideDuration: 3000,                                
                $MinDragOffsetToSlide: 20,                          
                $SlideWidth: 160,                                                                  
                $SlideSpacing: 50, 					                
                $DisplayPieces: 15,                                 
                $ParkingPosition: 0,                              
                $UISearchMode: 1,                                  
                $PlayOrientation: 1,                                
                $DragOrientation: 1                               
            };

            var logo_slider = new $JssorSlider$("slider_container", logo_options);
            
            $("#newsletterSignupBtn").click(function(e){
                e.preventDefault();
                console.log("newsletterSignupBtn", $("#fieldEmail").val());
                // $
                 document.location.href = '/newsletter?name='+$("#fieldEmail").val();
            })
        }
        loadMallDataCached(renderAll); 
    })
</script>